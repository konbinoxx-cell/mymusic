<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>🎵 自由音乐创作平台</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container">
        <h1>🎵 自由音乐创作平台</h1>
        <p class="subtitle">写旋律 · 配和弦 · 填歌词 · 录人声 · 导出MP3</p>

        <!-- 五线谱编辑区 -->
        <div class="control-group">
            <label>🎼 五线谱（点击添加音符）<span id="noteCount">0 个音符</span></label>
            <div class="staff-editor">
                <div class="staff" id="staff">
                    <!-- 五线谱线条由 JS 绘制 -->
                </div>
                <div class="staff-bars" id="staffBars"></div>
                <div class="note-palette">
                    <div class="note-option" data-note="C4">C4</div>
                    <div class="note-option" data-note="D4">D4</div>
                    <div class="note-option" data-note="E4">E4</div>
                    <div class="note-option" data-note="F4">F4</div>
                    <div class="note-option" data-note="G4">G4</div>
                    <div class="note-option" data-note="A4">A4</div>
                    <div class="note-option" data-note="B4">B4</div>
                    <div class="note-option" data-note="C5">C5</div>
                </div>
                <div class="staff-controls">
                    <button id="clearStaff">清空乐谱</button>
                    <button id="playStaff">播放旋律</button>
                    <button id="addBarLine">➕ 添加小节线</button>
                </div>
            </div>
        </div>

        <!-- 🎹 49键钢琴键盘 -->
        <div class="control-group">
            <label>🎹 49键钢琴键盘（C2 - C6）</label>
            <div class="piano-keyboard" id="pianoKeyboard"></div>
        </div>

        <!-- 调式 -->
        <div class="control-group">
            <label>🎼 调式</label>
            <select id="key">
                <option value="C">C 大调</option>
                <option value="G">G 大调</option>
                <option value="D">D 大调</option>
                <option value="A">A 大调</option>
                <option value="Am">A 小调</option>
                <option value="Em">E 小调</option>
                <option value="Dm">D 小调</option>
            </select>
        </div>

        <!-- 和弦进行 -->
        <div class="control-group">
            <label>🎸 和弦进行（4小节）</label>
            <div class="chord-progression">
                <select class="chord-select"><option>C</option><option>G</option><option>Am</option><option>F</option><option>Dm</option><option>Em</option></select>
                <select class="chord-select"><option>C</option><option selected>G</option><option>Am</option><option>F</option><option>Dm</option><option>Em</option></select>
                <select class="chord-select"><option>C</option><option>G</option><option selected>Am</option><option>F</option><option>Dm</option><option>Em</option></select>
                <select class="chord-select"><option>C</option><option>G</option><option>Am</option><option selected>F</option><option>Dm</option><option>Em</option></select>
            </div>
        </div>

        <!-- 歌词 -->
        <div class="control-group">
            <label>📝 歌词（支持 [和弦] 标记）</label>
            <textarea id="lyrics" placeholder="示例：
[Am] 今天的天空很蓝
[F] 我想和你一起唱歌"></textarea>
        </div>

        <!-- 风格与时间 -->
        <div class="controls">
            <div class="control-group">
                <label>🎨 音乐风格</label>
                <div class="preset-buttons">
                    <button class="preset-btn active" data-style="happy">😊 欢快</button>
                    <button class="preset-btn" data-style="calm">🌊 平静</button>
                    <button class="preset-btn" data-style="mystery">🔮 神秘</button>
                    <button class="preset-btn" data-style="energy">⚡ 活力</button>
                </div>
            </div>
            <div class="control-group">
                <label>⏱️ 时长</label>
                <select id="duration">
                    <option value="30">30 秒</option>
                    <option value="60" selected>60 秒</option>
                    <option value="120">2 分钟</option>
                </select>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button id="generateBtn" class="generate-btn">🎵 生成完整歌曲</button>
            <button id="stopBtn" class="stop-btn">⏹️ 停止播放</button>
            <button id="recordBtn" class="record-btn">● 开始录音</button>
            <button id="exportBtn" class="export-btn" disabled>💾 导出MP3</button>
            <button id="exportMidi" class="export-btn">🎹 导出MIDI</button>
        </div>

        <!-- 状态 -->
        <div class="status">
            <div id="statusText">准备就绪 — 点击五线谱或键盘开始创作！</div>
            <div class="loading" id="loading" style="display: none;">生成中…</div>
        </div>

        <!-- 指南 -->
        <div class="instructions">
            <h3>💡 使用提示</h3>
            <ul>
                <li>点击五线谱或键盘添加音符，双击删除</li>
                <li>音符从左到右顺序添加，与键盘位置无关</li>
                <li>中央 C（C4）会显示在五线谱下加一线</li>
                <li>点击“添加小节线”可手动划分乐句</li>
            </ul>
        </div>
    </div>

    <!-- 依赖库 -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.3.0/dist/lame.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
